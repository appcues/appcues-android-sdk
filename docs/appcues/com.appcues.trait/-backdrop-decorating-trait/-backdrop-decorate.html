<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <title>BackdropDecorate</title>
    <link href="../../../images/logo-icon.svg" rel="icon" type="image/svg">
    <script>var pathToRoot = "../../../";</script>
    <script>const storage = localStorage.getItem("dokka-dark-mode")
    if (storage == null) {
        const osDarkSchemePreferred = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
        if (osDarkSchemePreferred === true) {
            document.getElementsByTagName("html")[0].classList.add("theme-dark")
        }
    } else {
        const savedDarkMode = JSON.parse(storage)
        if(savedDarkMode === true) {
            document.getElementsByTagName("html")[0].classList.add("theme-dark")
        }
    }
    </script>
<script src="https://unpkg.com/kotlin-playground@1"></script><script type="text/javascript" src="../../../scripts/sourceset_dependencies.js" async="async"></script>
<link href="../../../styles/style.css" rel="Stylesheet">
<link href="../../../styles/jetbrains-mono.css" rel="Stylesheet">
<link href="../../../styles/main.css" rel="Stylesheet">
<link href="../../../styles/prism.css" rel="Stylesheet">
<link href="../../../styles/logo-styles.css" rel="Stylesheet">
<script type="text/javascript" src="../../../scripts/clipboard.js" async="async"></script>
<script type="text/javascript" src="../../../scripts/navigation-loader.js" async="async"></script>
<script type="text/javascript" src="../../../scripts/platform-content-handler.js" async="async"></script>
<script type="text/javascript" src="../../../scripts/main.js" defer="defer"></script>
<script type="text/javascript" src="../../../scripts/prism.js" async="async"></script>
<script type="text/javascript" src="../../../scripts/symbol-parameters-wrapper_deferred.js" defer="defer"></script>
</head>
<body>
<div class="navigation-wrapper" id="navigation-wrapper">
    <div id="leftToggler"><span class="icon-toggler"></span></div>
    <div class="library-name">
            <a href="../../../index.html">
                    <span>appcues</span>
            </a>
    </div>
    <div>
    </div>
    <div class="pull-right d-flex">
        <button id="theme-toggle-button"><span id="theme-toggle"></span></button>
        <div id="searchBar"></div>
    </div>
</div>
<div id="container">
    <div id="leftColumn">
        <div id="sideMenu"></div>
    </div>
    <div id="main">
<div class="main-content" id="content" pageIds="appcues::com.appcues.trait/BackdropDecoratingTrait/BackdropDecorate/androidx.compose.foundation.layout.BoxScope#kotlin.Function1[androidx.compose.foundation.layout.BoxScope,kotlin.Unit]/PointingToDeclaration//1172753313">
  <div class="breadcrumbs"><a href="../../../index.html">appcues</a><span class="delimiter">/</span><a href="../index.html">com.appcues.trait</a><span class="delimiter">/</span><a href="index.html">BackdropDecoratingTrait</a><span class="delimiter">/</span><span class="current">BackdropDecorate</span></div>
  <div class="cover ">
    <h1 class="cover"><span>Backdrop</span><wbr></wbr><span><span>Decorate</span></span></h1>
  </div>
  <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-dependent-content" data-active="" data-togglable=":appcues:dokkaHtml/release"><div class="symbol monospace"><div class="block"><div class="block"><span class="token annotation builtin">@</span><a href="https://developer.android.com/reference/kotlin/androidx/compose/runtime/Composable.html"><span class="token annotation builtin">Composable</span></a></div></div><span class="token keyword">abstract </span><span class="token keyword"></span><span class="token keyword">fun </span><a href="https://developer.android.com/reference/kotlin/androidx/compose/foundation/layout/BoxScope.html">BoxScope</a><span class="token punctuation">.</span><a href="-backdrop-decorate.html"><span class="token function">BackdropDecorate</span></a><span class="token punctuation">(</span><span class="parameters "><span class="parameter ">content<span class="token operator">: </span><span><span class="token annotation builtin">@</span><a href="https://developer.android.com/reference/kotlin/androidx/compose/runtime/Composable.html"><span class="token annotation builtin">Composable</span></a> </span><span class="token keyword"></span><a href="https://developer.android.com/reference/kotlin/androidx/compose/foundation/layout/BoxScope.html">BoxScope</a><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator"> -&gt; </span><span class="token keyword"></span><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-unit/index.html">Unit</a></span></span><span class="token punctuation">)</span></div><p class="paragraph">Decorates the backdrop of the experience</p><p class="paragraph">Example usage:</p><h4 class="">Samples</h4><div class="sample-container"><pre><code class="runnablesample monospace block lang-kotlin" theme="idea">import androidx.compose.animation.EnterTransition
import androidx.compose.animation.ExitTransition
import androidx.compose.animation.animateColorAsState
import androidx.compose.animation.core.AnimationSpec
import androidx.compose.animation.core.tween
import androidx.compose.animation.fadeIn
import androidx.compose.animation.fadeOut
import androidx.compose.foundation.background
import androidx.compose.foundation.isSystemInDarkTheme
import androidx.compose.foundation.layout.BoxScope
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.runtime.Composable
import androidx.compose.runtime.LaunchedEffect
import androidx.compose.runtime.State
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import com.appcues.data.model.AppcuesConfigMap
import com.appcues.data.model.getConfigColor
import com.appcues.data.model.styling.ComponentColor
import com.appcues.trait.AppcuesTraitAnimatedVisibility
import com.appcues.trait.BackdropDecoratingTrait
import com.appcues.trait.MetadataSettingTrait
import com.appcues.trait.extensions.rememberColorStepAnimation
import com.appcues.ui.composables.AppcuesStepMetadata
import com.appcues.ui.composables.LocalAppcuesStepMetadata
import com.appcues.ui.composables.rememberAppcuesBackdropVisibility
import com.appcues.ui.extensions.getColor
fun main() { 
   //sampleStart 
   internal class BackdropTrait(
    override val config: AppcuesConfigMap,
) : BackdropDecoratingTrait, MetadataSettingTrait {

    companion object {

        const val TYPE = &quot;@appcues/backdrop&quot;

        const val METADATA_BACKGROUND_COLOR = &quot;backgroundColor&quot;
    }

    override fun produceMetadata(): Map&lt;String, Any?&gt; {
        return hashMapOf(METADATA_BACKGROUND_COLOR to config.getConfigColor(&quot;backgroundColor&quot;))
    }

    @Composable
    override fun BoxScope.BackdropDecorate(content: @Composable BoxScope.() -&gt; Unit) {
        val metadata = LocalAppcuesStepMetadata.current
        val animation = rememberColorStepAnimation(metadata)
        val color = rememberBackgroundColor(metadata = metadata, animationSpec = animation)

        AppcuesTraitAnimatedVisibility(
            visibleState = rememberAppcuesBackdropVisibility(),
            enter = enterTransition(),
            exit = exitTransition(),
        ) {
            Spacer(
                modifier = Modifier
                    .fillMaxSize()
                    // set background color
                    .backdrop(color.value)
            )
        }

        content()
    }

    private fun Modifier.backdrop(color: Color?) = this.then(
        if (color != null) Modifier.background(color)
        else Modifier
    )

    private fun enterTransition(): EnterTransition {
        return fadeIn(tween(durationMillis = 300))
    }

    private fun exitTransition(): ExitTransition {
        return fadeOut(tween(durationMillis = 300))
    }

    @Composable
    private fun rememberBackgroundColor(metadata: AppcuesStepMetadata, animationSpec: AnimationSpec&lt;Color&gt;): State&lt;Color&gt; {
        val previousColor = rememberPreviousBackgroundColor(metadata)
        val actualColor = rememberActualBackgroundColor(metadata)

        // whenever metadata changes, set this to false
        val animateToActual = remember(metadata) { mutableStateOf(false) }

        return animateColorAsState(
            targetValue = if (animateToActual.value) actualColor else previousColor,
            animationSpec = animationSpec
        ).also {
            // whenever metadata updates, change value to true after first composition
            LaunchedEffect(metadata) { animateToActual.value = true }
        }
    }

    @Composable
    private fun rememberPreviousBackgroundColor(metadata: AppcuesStepMetadata): Color {
        val isDark = isSystemInDarkTheme()
        return remember(metadata) {
            (metadata.previous[METADATA_BACKGROUND_COLOR] as ComponentColor?).getColor(isDark) ?: Color.Transparent
        }
    }

    @Composable
    private fun rememberActualBackgroundColor(metadata: AppcuesStepMetadata): Color {
        val isDark = isSystemInDarkTheme()
        return remember(metadata) {
            (metadata.current[METADATA_BACKGROUND_COLOR] as ComponentColor?).getColor(isDark) ?: Color.Transparent
        }
    }
} 
   //sampleEnd
}</code></pre></div><h4 class="">Parameters</h4><div data-togglable="Parameters"><div class="table" data-togglable="Parameters"><div class="table-row" data-filterable-current=":appcues:dokkaHtml/release" data-filterable-set=":appcues:dokkaHtml/release"><div class="main-subrow keyValue WithExtraAttributes"><div class=""><span class="inline-flex"><div><u><span><span>content</span></span></u></div></span></div><div><div class="title"><div data-togglable="Parameters"><p class="paragraph">BackdropDecoratingTraits are chained together as one composition.     Its important to call <a href="-backdrop-decorate.html">content</a> if you want to apply every decoration on stack</p></div></div></div></div></div></div></div></div></div>
</div>
      <div class="footer">
        <span class="go-to-top-icon"><a href="#content" id="go-to-top-link"></a></span><span>© 2023 Copyright</span><span
                class="pull-right"><span>Generated by </span><a
                href="https://github.com/Kotlin/dokka"><span>dokka</span><span class="padded-icon"></span></a></span>
      </div>
    </div>
</div>
</body>
</html>
